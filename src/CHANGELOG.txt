# CHANGELOG

## [Latest] - 2025-11-29

### Feature: IntroTextSection Module
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **New Module** (`modules/home/IntroTextSection/IntroTextSection.jsx` + `.module.scss`)
   - Created simple intro section with Persian text between HeroSection and AboutMentorSection.
   - Used design tokens for colors and responsive spacing.

#### Impact:
- Homepage now features the intro text between hero and about mentor sections.

---

## [Latest] - 2025-11-27

### Enhancement: Hero Scroll CTA matches ornate badge asset
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **Scroll CTA Component** (`components/ui/ScrollCTAButton/ScrollCTAButton.jsx`)
   - Replaced generic `.card-button` markup with bespoke hero button structure.
   - Added default Persian label fallback and preserved smooth-scroll behavior.
   - Wired new SCSS module className handling so other sections can extend styles safely.

2. **Component Styling** (`components/ui/ScrollCTAButton/ScrollCTAButton.module.scss`)
   - Implemented ornate badge background using `/images/herobutton.png`.
   - Added hover/focus states, RTL alignment, and typography aligned with hero art direction.
   - Ensured overlay text sits centered with non-interactive label span.

3. **Design Tokens** (`styles/base/_variables.scss`)
   - Introduced hero button sizing + shadow custom properties for reuse across sections.

#### Impact:
- Hero CTA now visually matches the provided badge image with centered copy.
- Keeps accessible text, smooth scroll UX, and reusable tokens for future ornate CTAs.

---

## [Previous] - 2025-11-24

### Fix: ArticleGrid Load More Button Logic (Replicated from ProductGrid)
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **ArticleGrid Component** (`modules/articles/ArticleGrid/ArticleGrid.jsx`)
   - Added `initialMeta` prop to receive pagination metadata from server.
   - Changed `hasMore` calculation from `initialArticles.length === PAGE_SIZE` to `(page < pageCount)` logic.
   - Updated initial state to use `initialMeta.pagination.page` and `initialMeta.pagination.pageCount`.
   - Refactored `useEffect` sync logic to compare `page` vs `pageCount` instead of array length vs total.
   - Refactored sort effect to use `(p?.page || 1) < (p?.pageCount || 1)` pattern.
   - Refactored `handleLoadMore` to use `(p?.page || nextPage) < (p?.pageCount || 1)` pattern.
   - Changed `setArticles([...articles, ...result.data])` to `setArticles(prev => [...prev, ...result.data])`.

2. **Articles Page** (`app/articles/page.js`)
   - Extracted `initialMeta = result.meta` from API response.
   - Passed `initialMeta` prop to ArticleGrid component.

#### Technical Details:
- **Before**: `hasMore` compared `articles.length < total` which was unreliable.
- **After**: `hasMore` compares `currentPage < totalPageCount` matching ProductGrid pattern.
- **Logic Pattern**: `setHasMore((p?.page || nextPage) < (p?.pageCount || 1))`
- **State Management**: Uses pagination metadata from Strapi response for accurate button visibility.

#### Impact:
- Load More button now disappears correctly when all articles are loaded.
- Behavior matches ProductGrid exactly (working reference implementation).
- No more false-positive button display when pagination is exhausted.
- Clean Architecture maintained with API Layer abstraction.

---

## [Previous] - 2025-11-24

### Refactor: Centralized Pagination Constants (Single Source of Truth)
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **New Constants File** (`lib/constants.js`)
   - Created centralized configuration file for pagination settings.
   - Defined `ARTICLES_PAGE_SIZE = 6` as single source of truth.
   - Added constants for other entities: `PRODUCTS_PAGE_SIZE`, `COURSES_PAGE_SIZE`, `SERVICES_PAGE_SIZE`.

2. **ArticleGrid Component** (`modules/articles/ArticleGrid/ArticleGrid.jsx`)
   - Removed hardcoded `const PAGE_SIZE = 1`.
   - Imported `ARTICLES_PAGE_SIZE` from `lib/constants`.
   - Updated all references from `PAGE_SIZE` to `ARTICLES_PAGE_SIZE`.

3. **Articles Page** (`app/articles/page.js`)
   - Imported `ARTICLES_PAGE_SIZE` from `lib/constants`.
   - Changed hardcoded `6` to `ARTICLES_PAGE_SIZE` in `getArticlesPaginated` call.
   - Updated comments to reference constants file.

4. **API Route Handler** (`app/api/articles/route.js`)
   - Imported `ARTICLES_PAGE_SIZE` from `lib/constants`.
   - Changed default pageSize from `'6'` to `String(ARTICLES_PAGE_SIZE)`.
   - Updated JSDoc to reflect dynamic default value.

#### Impact:
- **Single Source of Truth**: Only need to change `ARTICLES_PAGE_SIZE` in one file (`lib/constants.js`).
- **Consistency**: All three layers (Client, Server, API) now use the same value.
- **Maintainability**: Easier to manage pagination settings across the app.
- **Scalability**: Template ready for other entities (products, courses, services).
- **No Breaking Changes**: Existing functionality preserved, only improved architecture.

---

## [Previous] - 2025-11-24

### Fix: ArticleGrid Category Filter Persistence & Load More Logic
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **ArticleGrid Component** (`modules/articles/ArticleGrid/ArticleGrid.jsx`)
   - **FIX 1: Category Filter Persistence**
     * Added `categoryParam` variable that includes `activeSlug` in fetch URLs for sorting and pagination.
     * Now passes `&categorySlug=${activeSlug}` to all `/api/articles` requests when a category is selected.
     * Ensures category filter persists across sort changes and load more actions.
   
   - **FIX 2: Load More Button Visibility**
     * Changed `hasMore` calculation from comparing page count to comparing total items.
     * New logic: `setHasMore(articles.length < meta.pagination.total)` or `setHasMore(updatedArticles.length < totalArticles)`.
     * Prevents button from showing when all items are loaded.
   
   - **FIX 3: State Synchronization**
     * Added `activeSlug` to useEffect dependency array for props sync.
     * Resets `isInitialMount` ref when `activeSlug` changes to allow proper re-filtering.

2. **API Route Handler** (`app/api/articles/route.js`)
   - Added `categorySlug` query parameter support.
   - Extracts `categorySlug` from search params and passes to `getArticlesPaginated()`.
   - Updated JSDoc comments to document the new parameter.

#### Technical Details:
- Sort effect now constructs URL: `/api/articles?page=1&pageSize=${itemsToFetch}&sort=${sortQuery}${categoryParam}`
- Load more constructs URL: `/api/articles?page=${nextPage}&pageSize=${PAGE_SIZE}&sort=${sortQuery}${categoryParam}`
- Where `categoryParam = activeSlug ? `&categorySlug=${activeSlug}` : ''`
- API route signature: `getArticlesPaginated(page, pageSize, sort, categorySlug)`

#### Impact:
- Category filter now works correctly with sorting and pagination.
- Load more button accurately reflects when all articles are loaded.
- No data duplication or missing items during filter transitions.
- Maintains Clean Architecture with proper data flow through API layers.

---

### Fix: ArticleGrid stale state sync
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. `modules/articles/ArticleGrid/ArticleGrid.jsx`
   - Added hydration effect to align local `articles`, `page`, and `hasMore` with new `initialArticles` props when category filter updates.
   - Prevented stale grids when navigating between categories via SSR data refresh.

---

### Feature: Navbar Articles MegaMenu
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **Server Component Updates (modules/layout/Navbar/Navbar.jsx)**
   - Imported `getArticleCategories` from articlesApi.
   - Fetched article categories in parallel with product categories.
   - Passed `articleCategoriesSnapshot` to client.

2. **Client Component Updates (modules/layout/Navbar/NavbarClient.jsx)**
   - Implemented generic `activeMegaMenu` state ('products' | 'articles').
   - Added "Articles" MegaMenu with image card layout.
   - Updated Mobile Drawer to include "Articles" tab and list.
   - Refactored hover logic to support multiple mega menus.

3. **Styling (modules/layout/Navbar/Navbar.module.scss)**
   - Added `.articleImage` and `.viewAllLink` styles for Article MegaMenu cards.
   - Reused existing grid and column styles.

---

## [Previous] - 2025-11-24

### Feature: Article Category Filter Integration
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **Server Component Updates (app/articles/page.js)**
   - Imported `getArticleCategories` from articlesApi
   - Fetch categories and articles in parallel with Promise.all
   - Extract `activeCategory` from searchParams
   - Pass `categorySlug` to `getArticlesPaginated` for filtered results
   - Pass `categories` and `activeSlug` props to ArticleGrid

2. **Client Component Updates (ArticleGrid.jsx)**
   - Imported `ArticleCategoryFilter` component
   - Accept `categories` and `activeSlug` props
   - Render filter component before SortControls
   - No prop-drilling errors

3. **Integration Verification**
   - Category filter appears at top of articles page
   - Clicking category updates URL with ?category=slug
   - Server re-renders with filtered articles
   - Clean Architecture maintained with API Layer abstraction

---

## [Previous] - 2025-11-02

### Feature: Navbar MegaMenu with SSR Category Fetching
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **SSR Category Fetching**
   - Created: `src/modules/layout/Navbar/NavbarClient.jsx` (client component)
   - Updated: `src/modules/layout/Navbar/Navbar.jsx` (server component)
   - Integrated: `getCategoryTree()` from `categoriesApi.js` with ISR caching (revalidate: 300s)
   - Data flows from SSR parent to client child component

2. **Desktop MegaMenu**
   - Hover-activated dropdown with 3-column grid (responsive: 2 columns @ tablet, 1 @ mobile)
   - Category titles with subcategories listed beneath each parent
   - Smooth fade-in/fade-down animation (translateY + opacity)
   - Backdrop blur effect with dark overlay background
   - Persistent on hover with pointer-events management

3. **Mobile Accordion Menu**
   - "محصولات" button expands to show all categories
   - Each category displays with nested subcategories
   - Animated slideDown expansion with border accent
   - Proper state management for open/closed accordion
   - Closes menu on navigation link click

4. **SCSS Module Updates**
   - Added: `.megaMenuWrapper`, `.megaMenu`, `.megaMenuGrid`, `.megaMenuColumn`
   - Added: `.mobileCategoryToggle`, `.mobileSubMenu`, `.mobileCategoryGroup`, `.mobileSubList`
   - Used design tokens: `var(--color-overlay)`, `var(--color-text-primary)`, `var(--font-md)`, etc.
   - Applied mixins: `@include m.hover-transition`, `@include m.respond()`
   - Animations: slideDown keyframe for mobile accordion

5. **Accessibility Features**
   - aria-expanded on mobile category toggle
   - aria-label for navigation elements
   - role="menu" and role="menuitem" for semantic structure
   - Keyboard-friendly buttons
   - Focus management with body scroll lock

#### Architecture Maintained:
- Server-Side Rendering (SSR) for category data
- Client-Side Interactivity (CSR) for UI state
- Clean component separation (Navbar → NavbarClient)
- API Layer abstraction (categoriesApi.js)
- SCSS Modules with design tokens
- RTL layout support
- Performance optimized (useCallback, ISR caching)

#### Technical Implementation:
- Server Component: Fetches categories via `getCategoryTree()`
- Client Component: Handles state (menu open/close, accordion expansion)
- Prop drilling: categories passed from server to client
- URL structure: `/products?category={slug}&subcategory={subslug}`

---

## [Latest] - 2025-11-03

### Refactor: Navbar MegaMenu Hover Stability & Animation
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Always-render mega menu with state-driven visibility class (`.megaMenuVisible`) to prevent flicker and gaps.
2. Unified SCSS: removed duplicate `.megaMenu` blocks and hover-coupled open rules; single transition source of truth.
3. Smooth open/close with opacity+translate transitions; pointer-events managed for stability.
4. Hover intent: delayed close (300ms) with enter/leave handlers to avoid accidental dismiss.
5. Accessibility: added `aria-label` and `aria-hidden`, and focus enter/leave to support keyboard.

#### Files Updated:
- `src/modules/layout/Navbar/NavbarClient.jsx`
- `src/modules/layout/Navbar/Navbar.module.scss`

#### Architecture & Styling:
- Preserved SSR snapshot from `Navbar.jsx` and API layer.
- SCSS Modules with design tokens; RTL friendly.

### Migration: Product Detail Page Route Refactor
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **Route Migration**
   - Moved: `src/app/products/[slug]/page.js` → `src/app/product/[slug]/page.js`
   - Moved: `src/app/products/[slug]/page.module.scss` → `src/app/product/[slug]/page.module.scss`
   - Rationale: Distinguish singular product detail page from plural products listing page

2. **Component Updates**
   - `src/components/cards/ProductCard/ProductCard.jsx`: Updated link from `/products/${slug}` to `/product/${slug}`
   - ProductGrid.jsx uses ProductCard component, so links are automatically updated

3. **Verification**
   - ✅ SSR rendering preserved (metadata generation intact)
   - ✅ Dynamic route params properly handled with `await params`
   - ✅ API Layer abstraction maintained (getProductBySlug from productsApi.js)
   - ✅ Error handling preserved (notFound() for invalid slugs)
   - ✅ Styles and layout unchanged

#### Architecture Maintained:
- Clean Architecture with API Layer abstraction
- Repository Pattern (productsApi.js)
- Server-Side Rendering (SSR) for SEO
- SCSS Module structure
- RTL layout support

#### Old Route:
- `src/app/products/[slug]/page.js` still exists (can be cleaned up or repurposed for categories)

#### New Route:
- `src/app/product/[slug]/page.js` now active for singular product detail pages
## [Latest] - 2025-11-04

### Enhancement: Dropdown Arrow on "محصولات" with Open State
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Added a toggleable arrow icon next to the "محصولات" link that rotates upward when the MegaMenu is open.
2. Updated `src/modules/layout/Navbar/NavbarClient.jsx` to render the arrow SVG and bind its open state to `isMegaMenuOpen`.
3. Updated `src/modules/layout/Navbar/Navbar.module.scss` with `.navLinkContent`, `.dropdownIcon`, and `.dropdownIconOpen` classes using design tokens (no hard-coded values).

#### Impact:
- Clear affordance for dropdown behavior on desktop navigation, aligned with RTL and theme tokens.

---

## [Latest] - 2025-11-06

### Enhancement: productsApi.getProductsPaginated category/subcategory filters
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Extended `src/lib/productsApi.js` → `getProductsPaginated(page, pageSize, sort, options?)` to accept optional `{ categorySlug, subCategorySlug, subSlugs = [] }` without breaking existing callers.
2. Implemented Strapi v4 filters via `URLSearchParams`:
   - If `subCategorySlug` → `filters[subCategory][slug][$eq] = {subCategorySlug}`
   - Else if `categorySlug` → OR filter:
     - `filters[$or][0][category][slug][$eq] = {categorySlug}`
     - `filters[$or][1][subCategory][slug][$in] = subSlugs.join(',')` (when provided)
3. Preserved output structure: `{ data, meta }` unchanged, including pagination meta and error fallback.

#### Notes:
- `subSlugs` should be provided by SSR from `categoriesApi` when a category is selected to include all its subcategories.
- No UI/component changes required; API remains backward-compatible with previous 3-arg calls.

### Feature: SSR Initial Render from URL for /products
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Updated `src/app/products/page.js` to read `searchParams` → `category`, `sub`, `sort`, `page`.
2. When `category` present and `sub` absent, fetched `getCategoryTree()` and derived `subSlugs` for that category.
3. Called `getProductsPaginated(page, 6, sort, { categorySlug, subCategorySlug, subSlugs })` for initial SSR data.
4. Fetched categories snapshot via `getCategoryTree()` and passed to client.
5. Added `src/modules/products/ProductsPageClient/ProductsPageClient.jsx` (client) to receive initial props and render `ProductGrid`.

#### Impact:
- Enables direct URL-driven SSR filtering and pagination for better SEO and first paint.
- Keeps Clean Architecture with API Layer and server→client data flow.

### Feature: CategoryFilter component (UI-only, emits events)
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Added `src/modules/products/components/CategoryFilter.jsx` (client component) with two states:
   - No active category: shows scrollable category pills.
   - Active category: large selected box on the right + subcategory pills on the left.
2. Added `src/modules/products/components/CategoryFilter.module.scss` styled with theme tokens:
   - Dark background, gold accents, RTL-friendly layout.
   - Hover/active states, subtle elevation, responsive grid (2→1 columns on mobile).
3. Accessibility: `aria-label`, `aria-pressed`, `type="button"` on interactive elements.

#### Usage Notes:
- Receives data via props; emits only events: `onSelectCategory(slug)`, `onSelectSubCategory(slug)`.
- Update URL handling in the parent to set `?category=` and `?sub=` as needed.

### Enhancement: ProductGrid filtering + pagination reset logic
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. `src/modules/products/ProductGrid/ProductGrid.jsx`
   - Added `category` and `sub` query params to all fetches.
   - On `sort`, `activeCategory`, or `activeSubCategory` change: refetch from page 1 and replace products.
   - On load more: fetch next page in current filters and append.
   - Standardized `PAGE_SIZE` to 6 and aligned `page`/`hasMore` with API meta.

### Enhancement: /api/products route supports filters (category, sub, sort, page, pageSize)
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Updated `src/app/api/products/route.js` to parse `category`, `sub`, `sort`, `page`, `pageSize`.
2. When a category is selected without a subcategory, derive `subSlugs` via `getCategoryTree()` for inclusive filtering.
3. Call `getProductsPaginated(page, pageSize, sort, { categorySlug, subCategorySlug, subSlugs })` and return `{ data, meta }` unchanged.

#### Impact:
- Ensures URL-driven UX for `/products`, `/products/{category}`, and `/products/{category}/{sub}` with correct filtering and pagination.

### Fix: Align product filters with `categories` relation slug equality
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Updated `src/lib/productsApi.js` → `getProductsPaginated` query build to:
   - If `subCategorySlug`: `filters[categories][slug][$eq] = subCategorySlug`
   - Else if `categorySlug`: `filters[categories][slug][$eq] = categorySlug`

#### Rationale:
- Backend expects filtering via unified `categories` relation; removes previous OR/in logic.

---

## [Latest] - 2025-11-17

### Enhancement: Products List Category UI Refresh
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Rebuilt the `/products` category selector UI to visually match `ProductCategoriesSection`:
   - Updated `src/modules/products/ProductsPageClient/components/CategoryFilter.jsx` to render circular icon cards with Next/Image and fallback placeholders.
   - Added structured layout states: full grid when no category is selected and split layout (selected card on the right, subcategories list on the left) when a category is active.
2. Created `src/modules/products/ProductsPageClient/components/CategoryFilter.module.scss` mirroring the home category card styling:
   - Reused theme tokens (`var(--color-overlay)`, `var(--gradient-card-vertical)`, etc.), RTL grid, hover/focus transitions, and pill-style subcategory highlights.
   - Added responsive rules to collapse the two-column layout on tablet/mobile while keeping typography/spacing consistent with the homepage.
3. Preserved SPA filtering contracts by keeping `onSelectCategory`/`onSelectSubCategory` signatures untouched and including reset actions ("بازگشت" + "همه زیر‌دسته‌ها") to avoid URL or pagination regressions.
4. Fixed back navigation by preventing the category reset button from firing the subcategory router logic, eliminating the stuck state on `/products/{category}`.
5. Added `public/images/placeholder.png` fallback so circular category icons always render even when Strapi lacks an image.

#### Impact:
- Category icons, typography, and spacing now stay consistent between Home and Products pages.
- Subcategory list provides clear active states without interfering with existing load-more, sort, or routing logic.


## [Latest] - 2025-11-18

### Fix: Remove forced `page` query resets in ProductsPageClient
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. `src/modules/products/ProductsPageClient/ProductsPageClient.jsx`
   - Deleted the `params.set('page', '1')` calls in `handleSelectCategory`, `handleSelectSub`, and `handleChangeSort`.
   - Keeps existing search params intact so URLs no longer auto-append `?page=`.

#### Impact:
- Prevents redundant `page` query strings during category/subcategory selection and sort changes.
- Router updates now preserve whatever paging logic already exists in the URL or defaults.

### UI Update: Modern Glassmorphism Styles for CategoryFilter
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. `src/modules/products/ProductsPageClient/components/CategoryFilter.module.scss`
    - Completely overhauled styles to use modern glassmorphism.
    - Added `backdrop-filter: blur`, semi-transparent backgrounds, and subtle borders.
    - Enhanced gradients for cards and active states to match the dark/gold theme.
    - Improved hover and focus states with smooth transitions, scaling, and shadows.
    - Refined layout spacing and responsiveness.
    - Used complex box-shadows for depth and glowing effects.

#### Impact:
- Significant visual upgrade to the category filter on the products page, aligning it with a more premium, modern aesthetic.

## [Latest] - 2025-11-19

### Feature: Nested Route Structure for Products
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **Nested Routing Implementation**
   - Created `src/app/products/[category]/page.js`: SSR listing page for categories.
   - Created `src/app/products/[category]/[subcategory]/page.js`: SSR listing page for subcategories.
   - Created `src/app/products/[category]/[subcategory]/[slug]/page.js`: SSR single product page (deep link).
   - Created `src/app/products/[category]/[subcategory]/[slug]/page.module.scss`: Styles for the deep product page.

2. **SSR Data Flow**
   - Listing pages await `params` and `searchParams` (Next.js 15 compatible).
   - Listing pages fetch data via `getProductsPaginated` with `categorySlug` or `subCategorySlug` filters.
   - Listing pages fetch `getCategoryTree` for sidebar/filter context.
   - Single product page fetches data via `getProductBySlug`.

3. **Component Reuse**
   - Reused `ProductsPageClient` for listing pages, passing initial data and category context.
   - Reused `ProductGallery` and styles for the single product page.

#### Architecture Maintained:
- **Clean Architecture**: API calls abstracted in `lib/productsApi.js`.
- **SSR First**: All initial data fetching happens on the server for SEO.
- **Client Hydration**: `ProductsPageClient` takes over for interactive filtering.
- **Backward Compatibility**: Old `src/app/product/[slug]` route preserved for future redirects.

### Feature: Breadcrumb Navigation & Legacy Redirects
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Added `src/components/ui/Breadcrumb.jsx` + `.module.scss` with LD-JSON schema output, RTL styling, and design tokens.
2. Injected `<Breadcrumb />` into `/products`, `/products/[category]`, `/products/[category]/[subcategory]`, and the deep product page to mirror URL hierarchy.
3. Refactored legacy `src/app/product/[slug]/page.js` into a pure `permanentRedirect` handler that resolves canonical category paths via `productsApi`.

#### Impact:
- Ensures consistent UX breadcrumbs with structured data for SEO rich snippets.
- Guarantees 301 redirects from legacy `/product/:slug` URLs to the nested `/products/:category/:sub/:slug` routes.
- Keeps Clean Architecture by reusing API layer helpers and SCSS modules.

### Enhancement: ProductCard Nested Route Support
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **ProductCard Component** (`src/components/cards/ProductCard/ProductCard.jsx`)
   - Added `constructProductUrl()` logic to dynamically build nested route URLs based on product categories.
   - Implements priority-based URL construction:
     * Priority 1: Subcategory (category with parent) → `/products/{parent}/{subcategory}/{slug}`
     * Priority 2: Root category → `/products/{category}/{slug}`
     * Priority 3: Fallback to legacy route → `/product/{slug}` (triggers 301 redirect)
   - Gracefully handles missing category data with fallback mechanism.

2. **Data Layer Enhancement** (`src/lib/strapiUtils.js`)
   - Updated `formatStrapiProducts()` to include `categories` array with parent relationship.
   - Each category now includes: `{ slug, name, parent: { slug, name } | null }`.
   - Supports both nested Strapi v4 structure (`attributes.parent.data`) and flat structure.

#### Impact:
- ProductCard now generates SEO-friendly nested URLs automatically.
- Backward compatible: cards without category data fall back to legacy route with 301 redirect.
- Maintains Clean Architecture with data formatting in strapiUtils layer.
- No breaking changes to existing ProductCard usage.

### Refactor: Extract ProductDetails Reusable Component
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **New Component** (`src/modules/products/ProductDetails/ProductDetails.jsx`)
   - Extracted UI structure from single product page into reusable component.
   - Props: `{ product, breadcrumbItems }`.
   - Renders: Breadcrumb, ProductGallery, product info (title, price, description), add-to-cart button.
   
2. **Styles Module** (`src/modules/products/ProductDetails/ProductDetails.module.scss`)
   - Migrated styles from page-level to component-level.
   - Responsive grid layout (2 columns desktop, 1 column mobile).
   - Uses design tokens for colors, spacing, and typography.

3. **Page Refactor** (`src/app/products/[category]/[subcategory]/[slug]/page.js`)
   - Removed inline JSX and styles import.
   - Now imports and renders `<ProductDetails />` component.
   - Keeps SSR data fetching logic (getProductBySlug, getCategoryTree, getProductBreadcrumbs).
   - Maintains metadata generation for SEO.

#### Impact:
- ProductDetails component ready for reuse in hybrid `/product/[slug]` route.
- Separates UI concerns from data fetching logic.
- Maintains Clean Architecture and SSR patterns.
- No visual or functional changes to the product detail page.

### Feature: Hybrid Route Resolver for /products/[category]/[subcategory]
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. **Hybrid Route Logic** (`src/app/products/[category]/[subcategory]/page.js`)
   - Step 1: Fetch category tree and validate category param.
   - Step 2: Check if `subcategory` param is a valid subcategory of `category`:
     * **YES**: Render subcategory listing page with ProductsPageClient.
     * **NO**: Attempt to fetch product using `getProductBySlug(subcategory)`:
       - **Product found**: Render ProductDetails component with correct breadcrumbs.
       - **Product not found**: Call `notFound()`.

2. **Dynamic Metadata Generation**
   - Detects route type (subcategory vs product) before generating metadata.
   - Subcategory: Generates listing page title/description.
   - Product: Generates product detail title/description using product data.
   - Invalid route: Returns "صفحه یافت نشد".

3. **Smart Breadcrumb Resolution**
   - For products: Attempts to match product's categories with URL category param.
   - Falls back to URL-based category if no match found in product data.
   - Ensures breadcrumbs remain accurate regardless of URL structure.

4. **Component Reuse**
   - Uses existing `ProductsPageClient` for listing pages.
   - Uses new `ProductDetails` component for product detail pages.
   - Maintains consistent UI/UX across both route types.

#### Architecture Maintained:
- **SSR First**: All data fetching on server for SEO optimization.
- **Clean Architecture**: API Layer abstraction (productsApi, categoriesApi).
- **DRY Principle**: Reuses ProductDetails component instead of duplicate JSX.
- **Next.js 15 Compatible**: Properly awaits params and searchParams.

#### Impact:
- Resolves routing collision: `/products/cat/slug` now intelligently determines if "slug" is a subcategory or product.
- Eliminates need for separate deep route at `/products/[category]/[subcategory]/[slug]`.
- Maintains backward compatibility with existing subcategory listing pages.
- Improves SEO with dynamic metadata generation based on route type.

## [Latest] - 2025-11-22

### Feature: ListGuard SSR Wrapper & EmptyState Upgrade
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Added `src/components/layout/ListGuard.jsx` server component to guard list views by rendering children, filter-based empty states, or global empty messaging using configurable `entityName` and `resetLink`.
2. Enhanced `src/components/ui/EmptyState/EmptyState.jsx` to support optional `description`, `actionLabel`, and `actionHref` props, enabling reusable messaging with contextual CTAs.
3. Updated `src/components/ui/EmptyState/EmptyState.module.scss` with design tokens, layout refinements, and button styling to match the dark theme with gold accents while remaining RTL-friendly.
4. Integrated `ListGuard` across `/products`, `/articles`, `/courses`, and `/services` pages so all grids now share consistent empty feedback driven by URL filters.

## [Latest] - 2025-11-24

### Fix: Article filter populate consistency
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Updated `lib/articlesApi.js` → `getArticlesPaginated` to include `articles_categories` in `populate` while keeping the confirmed filter key `filters[articles_categories][slug][$eq]` for reliable Strapi filtering.

---

### Fix: Article category filter query alignment
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Updated `lib/articlesApi.js` → `getArticles` and `getArticlesPaginated` to use Strapi’s exact relation key `filters[articles_categories][slug][$eq]` when filtering by category slug.
2. Ensured both limited and paginated article fetchers query the correct `articles_categories` relation to restore backend filtering.

---

### Feature: ArticleCategoryFilter Component
**Status**: ✅ COMPLETED (100%)

#### Changes Made:
1. Created `src/modules/articles/components/ArticleCategoryFilter.jsx` (client component):
   - Accepts `categories` array and `activeSlug` from URL query param.
   - Handles category selection via Next.js router.push with query param `?category=slug`.
   - Resets pagination on category change (removes `page` param).
   - Flat category structure (no subcategories logic).
   - Includes "نمایش همه" clear button when a category is active.

2. Created `src/modules/articles/components/ArticleCategoryFilter.module.scss`:
   - Glassmorphism design matching ProductCategoryFilter aesthetics.
   - Uses design tokens (`var(--color-text-primary)`, `var(--color-title-hover)`, etc.).
   - Responsive grid layout (auto-fit, minmax).
   - Active category indicator with checkmark badge.
   - Hover effects with transform, glow, and backdrop-filter.
   - RTL-friendly layout with proper spacing and alignment.

3. Visual Features:
   - Category cards with circular icon wrappers.
   - Gold accent borders and hover states.
   - Active state highlighting with checkmark badge.
   - Smooth transitions (0.4s cubic-bezier).
   - Responsive breakpoints (1024px, 600px).

#### Architecture Maintained:
- Client-side component for interactivity.
- URL-driven state management via Next.js router.
- Clean separation from products CategoryFilter (no code reuse).
- SCSS Modules with design token system.
- Accessibility features (aria-label, aria-current, focus states).

#### Impact:
- Articles listing page can now integrate category filtering UI.
- Consistent visual language with products section.
- SEO-friendly URL structure with query params.
- Ready for integration with ArticleGrid and /articles page.